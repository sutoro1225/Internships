# プッシュ通知の分析によるF2転換率改善プロジェクト

[株式会社ヤプリ](https://yappli.co.jp/)のデータサイエンス室でのインターンシップで実施した、プッシュ通知の特徴量エンジニアリングと分析プロジェクトです。

このプロジェクトでは、**F2転換率**（初回購入後、一定期間内に2回目の購入を行う割合）の改善を目的として、プッシュ通知の内容や送り方がユーザー行動に与える影響を分析しました。

実際のブログ記事：[Yappliのデータサイエンス室でインターン生としてプッシュ通知を分析してみた話](https://tech.yappli.io/entry/ds-intern-push-analyze)

## プロジェクト概要

プッシュ通知はユーザー行動を促す有力な手段である一方で、内容や送り方によっては「ノイズ」になり、かえってユーザー体験を損ねてしまう可能性があります。本プロジェクトでは、プッシュ通知のテキストデータから特徴量を抽出し、ユーザーのF2ステージ到達との関係を分析しました。

### 主な分析内容

1. **通知文言の長さ**：通知文の長さがF2転換率に与える影響
2. **割引ワードの有無**：割引情報を含む通知がF2転換率に与える影響
3. **時間帯**：配信時間帯がF2転換率に与える影響
4. **配信グループ**：セグメント配信と全体配信の効果比較

## ファイル構成

```
feature_engineering_push_notice/
├── README.md
├── BigQuery/                              # BigQuery用SQLクエリ
│   ├── create_push_notice_joined_table.sql        # プッシュ通知と特徴量テーブルの結合
│   ├── create_notice_user_f2_24h_table.sql        # ユーザー行動データと特徴量の結合テーブル作成
│   └── create_purchase_with_fstage.sql            # 購入データにFステージ特徴量を追加
├── ipynb/                                  # Jupyterノートブック
│   └── 01_feature_engineering.ipynb        # データ準備、特徴量エンジニアリング、可視化
├── output/                                  # 分析結果
│   ├── summary.json                        # 特徴量のサマリー
│   └── visualizations/                     # 特徴量の可視化画像
│       ├── hist_*.png                      # 特徴量の分布ヒストグラム
│       └── bar_*.png                       # 特徴量別のF2転換率比較
└── results/                                 # 分析結果の可視化画像
    ├── analysis_notice_length_table.png     # 通知文の長さ別F2転換率
    ├── analysis_discount_word_table.png     # 割引ワード有無別F2転換率
    ├── analysis_time_band_table.png         # 時間帯別F2転換率
    ├── analysis_push_type_table.png         # 配信グループ別F2転換率
    └── analysis_push_type_comparison.png    # 配信グループ比較
```

## 技術スタック

- **データ分析**: Python (pandas, numpy, matplotlib, seaborn)
- **データベース**: Google BigQuery
- **SQL**: BigQuery SQL
- **可視化**: Matplotlib, Seaborn

## 分析手法

### 1. データ準備

プッシュ通知の生データから、分析に必要な情報を抽出・整形しました。

- 通知文のテキストデータ
- 配信時間
- 配信グループ（セグメント/全体配信）
- ユーザーの開封・アクション情報

### 2. 特徴量エンジニアリング

プッシュ通知のテキストから以下の特徴量を抽出しました：

- **文の長さ**: 文字数、単語数、長さのビン分け
- **割引情報**: 割引ワードの有無、割引額、割引率、割引タイプ
- **感情表現**: 絵文字の使用有無・数、記号の数、感嘆符の数
- **行動喚起**: CTAワード、クーポンワード、時間制限ワードの有無
- **配信タイプ**: セグメント配信 vs 全体配信

### 3. 分析

抽出した特徴量と、24時間以内のF2転換率の関係を分析しました。

主要な分析結果：
- 通知文の長さが中程度（medium）のものが最も効果的
- 割引ワードを含む通知はF2転換率が高い
- 時間帯によって効果が異なる（午後の配信が効果的）
- 配信グループによっても効果が異なる

詳細は[ブログ記事](https://tech.yappli.io/entry/ds-intern-push-analyze)をご覧ください。

## BigQuery SQLファイルの説明

### `create_push_notice_joined_table.sql`
プッシュ通知データと特徴量テーブルを結合し、分析用の統合テーブルを作成します。

### `create_notice_user_f2_24h_table.sql`
ユーザーの通知開封イベントと特徴量、24時間以内のF2購入情報を結合したテーブルを作成します。

### `create_purchase_with_fstage.sql`
購入データからFステージ（初回購入、2回目購入など）を計算し、ユーザーの購入履歴に追加します。

## 注意事項

- **機密情報のマスク**: データファイルには機密情報が含まれていたため、企業名、ブランド名、商品名、商品カテゴリなどは以下のようにマスクしています
  - 企業名: `[COMPANY_NAME]`
  - ブランド名: `[ブランド名]` / `[ブランド名1-4]`
  - 商品名: `[PRODUCT_NAME]` / `[商品名]` / `[商品名2-7]`
  - 商品カテゴリ: `[商品カテゴリ]`
  - 商品タイプ: `[商品タイプ1]` / `[商品タイプ2]`
  - 商品シリーズ: `[シリーズ名1]` / `[シリーズ名2]`
  - その他: `[カラーバリエーション]` / `[アイテム]`
  - データベース名・テーブル名: `project-dataset.client_project.*`
  
- **データファイル**: 機密情報保護のため、生データファイル（CSV）は削除しています。分析結果の可視化画像（グラフ）は`output/visualizations/`と`results/`に残しています。

- **Jupyterノートブック**: 
  - コード内のコメントや正規表現パターンに含まれる機密情報（企業名・ブランド名・商品名）は`[COMPANY_NAME]`、`[ブランド名]`、`[商品名]`、`[PRODUCT_NAME]`に置換しています
  - 実行結果（出力セル）は削除済みです。コードのみが残っています。

- **実際のプロジェクト**: より詳細な特徴量や分析が含まれていますが、機密保持のため一部情報を省略しています

## 参考文献

- [Yappli Tech Blog: Yappliのデータサイエンス室でインターン生としてプッシュ通知を分析してみた話](https://tech.yappli.io/entry/ds-intern-push-analyze)

## ライセンス

このプロジェクトはインターンシップの成果物として公開されています。
